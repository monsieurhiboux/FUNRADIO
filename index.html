<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PUFF RADIO</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script defer src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script defer src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-gray-900 text-gray-200 font-sans min">
    <!-- Conteneur principal -->
    <div class="flex min-h-scren">
        <!-- Sidebar gauche -->
        <div class="flex flex-col min-h-screen w-38 bg-gray-800 p-4">
            <div class="mb-6">
                <h1 class="text-2xl font-bold text-purple-400">PUFF RADIO</h1>
            </div>
            <nav>
                <ul class="space-y-4">
                    <li>
                        <a href="#" class="flex items-center space-x-3 text-gray-300 hover:text-white">
                            <span class="w-6 h-6 flex items-center justify-center rounded">üè†</span>
                            <span>Accueil</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" class="flex items-center space-x-3 text-gray-300 hover:text-white">
                            <span class="w-6 h-6 flex items-center justify-center rounded">üé•</span>
                            <span>Vid√©os</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" class="flex items-center space-x-3 text-gray-300 hover:text-white">
                            <span class="w-6 h-6 flex items-center justify-center rounded">üóìÔ∏è</span>
                            <span>Planning</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" class="flex items-center space-x-3 text-gray-300 hover:text-white">
                            <span class="w-6 h-6 flex items-center justify-center rounded">üí¨</span>
                            <span>Chat</span>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>

        <!-- Contenu principal -->
        <div class="flex bg-gray-900 flex-1">
            <!-- Image dynamique en React -->
            <!-- Infos sur le stream -->
            <div class="flex-1 grow">
                <div class="relative">
                    <div id="imageApp" class="aspect-video"></div>
                    <div id="audioPlayerContainer" class="absolute bottom-4 left-4"></div>
                </div>
                <div class="flex flex-col md:flex-row md:items-center justify-between mt-3 border-b border-gray-700 m-4 pb-4">
                    <div>
                        <h2 class="text-2xl font-bold text-purple-400">PUFF RADIO LIVE 24h/24 üî¥</h2>
                        <p class="text-gray-400">RADIO | PUFF RADIOPUFF PUFFRADIO RADIO INSUPPORTABLE | Nombre de viewers : <span class="font-bold text-purple-400" id="viewCount">1000</span> </p>
                    </div>
                    <button class="mt-4 md:mt-0 bg-purple-600 px-4 py-2 rounded text-white hover:bg-purple-500">
                        Vous √™tes abonn√©¬∑e √† FUN RADIO
                    </button>
                </div>
            </div>
        </div>
        <div class="w-96 none">
            <!-- Chat avec React --> 
            <div id="chatApp"></div>
        </div>
    </div>


    <script type="text/babel">
        const messages = [
            { pseudo: "DJMax", color: "#FF5733", text: "Salut tout le monde!" },
            { pseudo: "FanDeHits", color: "#33FF57", text: "G√©nial ce stream!" },
            { pseudo: "MusicLover87", color: "#5733FF", text: "Quelqu'un a le nom de la musique?" },
            { pseudo: "DanceFloorKing", color: "#FF33A8", text: "Let's gooooo üî•" },
            { pseudo: "HitHunter", color: "#A833FF", text: "Incroyable !" },
            { pseudo: "BassMaster", color: "#33CFFF", text: "Boom Boom Bass üéß" },
            { pseudo: "ElectroVibes", color: "#FFC300", text: "Cette vibe est folle!" },
            { pseudo: "NightRider", color: "#DAF7A6", text: "Allons jusqu'au bout de la nuit!" },
            { pseudo: "PlaylistAddict", color: "#C70039", text: "Direct dans ma playlist!" },
            { pseudo: "RaveQueen", color: "#581845", text: "On bouge tous!" },
            { pseudo: "DJMarkus", color: "#900C3F", text: "Du lourd ce son üî•" },
            { pseudo: "LoudAndProud", color: "#1ABC9C", text: "On monte le volume!" },
            { pseudo: "BeatCrusher", color: "#2E4053", text: "Ce beat est monstrueux!" },
            { pseudo: "FunStreamer", color: "#F39C12", text: "Merci pour ce live üé∂" },
            { pseudo: "TranceLover", color: "#9B59B6", text: "Ce son, une dinguerie!" },
            { pseudo: "PartyStarter", color: "#5DADE2", text: "On lance la soir√©e!" },
            { pseudo: "Dance4Life", color: "#D35400", text: "Je danse seul chez moi üíÉ" },
            { pseudo: "WaveRider", color: "#7D3C98", text: "Les ondes sont parfaites!" },
            { pseudo: "MixMaster77", color: "#28B463", text: "Qui mixe ce soir ?" },
            { pseudo: "GrooveAddict", color: "#E74C3C", text: "Impossible de rester assis!" },
            { pseudo: "SoundHunter", color: "#9C640C", text: "Nouvelle p√©pite d√©couverte!" },
            { pseudo: "ClubKing", color: "#2471A3", text: "Club mode ON!" },
            { pseudo: "ElectroZed", color: "#D5DBDB", text: "C‚Äôest quoi ce feu üî•üî•" },
            { pseudo: "BassAddict99", color: "#6E2C00", text: "Le drop m'a tu√© üò±" },
            { pseudo: "HitCraver", color: "#45B39D", text: "La soir√©e commence ici!" },
            { pseudo: "NightDancer", color: "#AED6F1", text: "On l√¢che rien!" },
            { pseudo: "EnergyVibes", color: "#C0392B", text: "Que de l'√©nergie!" },
            { pseudo: "StreamAddict", color: "#7FB3D5", text: "Stream au top comme d'hab!" },
            { pseudo: "MusicGod", color: "#8E44AD", text: "Trop bon!" },
            { pseudo: "TheDropper", color: "#3498DB", text: "Le drop !!! üí£" },
            { pseudo: "ClubQueen", color: "#2ECC71", text: "Les pieds dans le rythme!" },
            { pseudo: "VibeSensation", color: "#B7950B", text: "Vibes √† fond!" },
            { pseudo: "FunDJMax", color: "#A04000", text: "Fun Radio en force!" },
            { pseudo: "RaveManiac", color: "#F7DC6F", text: "La rave commence!" },
            { pseudo: "DuoGroove", color: "#B03A2E", text: "Du bon groove ce soir üé∂" },
            { pseudo: "HypeBass", color: "#1F618D", text: "On veut plus de basses!" },
            { pseudo: "NightWolf", color: "#D7BDE2", text: "Hurlons √† la lune!" },
            { pseudo: "SoundKing", color: "#85C1E9", text: "La musique est reine!" },
            { pseudo: "PartyCraver", color: "#7E5109", text: "Encore un son comme √ßa!" },
            { pseudo: "DreamBass", color: "#A3E4D7", text: "Le son de mes r√™ves!" },
            { pseudo: "RushVibes", color: "#2980B9", text: "√áa monte, √ßa monte! üöÄ" },
            { pseudo: "SilentRaver", color: "#212F3C", text: "Casque sur les oreilles üíÄ" },
            { pseudo: "TwerkMachine", color: "#AF7AC5", text: "√áa twerk ici?" },
            { pseudo: "NightDJ", color: "#7DCEA0", text: "DJ, envoie du lourd!" },
            { pseudo: "ElectroPulse", color: "#C0392B", text: "Les pulsations √©lectriques!" },
            { pseudo: "BeatSlayer", color: "#1C2833", text: "Quel massacre ce beat!" },
            { pseudo: "HouseHero", color: "#D98880", text: "La house est reine ici!" },
            { pseudo: "FunkyFresh", color: "#7B241C", text: "Fra√Æcheur musicale!" },
            { pseudo: "DropHunter", color: "#F0B27A", text: "On guette le prochain drop!" },
            { pseudo: "FunElectro", color: "#C0392B", text: "Que des hits ici!" },
            { pseudo: "UltraRaver", color: "#A93226", text: "On ne dort pas ce soir!" },
            { pseudo: "VibraDancer", color: "#EC7063", text: "Vibrez avec moi!" },
            { pseudo: "SoulGroover", color: "#1ABC9C", text: "Groove dans l'√¢me!" },
            { pseudo: "ClubStorm", color: "#884EA0", text: "Temp√™te sur le dancefloor!" },
            { pseudo: "WaveMachine", color: "#3498DB", text: "Toujours plus de sons!" },
            { pseudo: "MegaBass", color: "#2E86C1", text: "Les voisins s'√©nervent d√©j√† üòÇ" },
            { pseudo: "LightItUp", color: "#B7950B", text: "On allume tout ce soir!" },
            { pseudo: "ElectroKnight", color: "#17202A", text: "Le chevalier des platines!" },
            { pseudo: "NightPulse", color: "#9B59B6", text: "Pulse nocturne üíì" },
            { pseudo: "DanceHero", color: "#7D3C98", text: "En mode h√©ros de la danse!" },
            { pseudo: "HitRider", color: "#58D68D", text: "En route pour les hits!" },
            { pseudo: "JumpMaster", color: "#B9770E", text: "On saute tous ensemble!" },
            { pseudo: "VibeBooster", color: "#212F3D", text: "La soir√©e explose!" },
            { pseudo: "PartyWizard", color: "#A04000", text: "De la magie sonore!" },
            { pseudo: "EnergyCrush", color: "#E59866", text: "Tout cramer niveau √©nergie!" },
            { pseudo: "SoundBlaster", color: "#7B7D7D", text: "La vibe nous tue!" },
            { pseudo: "DanceMachine", color: "#82E0AA", text: "La machine est lanc√©e!" },
        ];

        function ChatApp() {
            const [chatMessages, setChatMessages] = React.useState([]);
            const chatEndRef = React.useRef(null);

            // Add this useEffect to scroll to the bottom whenever chatMessages changes
            React.useEffect(() => {
                if (chatEndRef.current) {
                    chatEndRef.current.scrollIntoView({ behavior: 'smooth' });
                }
            }, [chatMessages]);

            React.useEffect(() => {
                const interval = setInterval(() => {
                    const newMessage = messages[Math.floor(Math.random() * messages.length)];
                    setChatMessages(prev => [
                        ...prev.slice(),
                        {
                            pseudo: newMessage.pseudo,
                            text: newMessage.text,
                            color: newMessage.color
                        }
                    ]);
                }, 800);
                return () => clearInterval(interval);
            }, []);

            return (
                <div className="flex-1 overflow-y-auto max-h-screen">
                    <h3 className="bg-gray-900 text-lg font-bold mb-2 text-purple-400 border-b border-gray-700 p-2 text-center sticky top-0">Chat en direct</h3>
                    <div className="flex-1 rounded p-2 px-4">
                        {chatMessages.map((msg, index) => (
                            <div key={index} className="my-1">
                                <span style={{ color: msg.color }}>{msg.pseudo}</span> : {msg.text}
                            </div>
                        ))}
                        {/* This div will keep the scroll at the bottom */}
                        <div ref={chatEndRef} />
                    </div>
                </div>
            );
        }

        function ImageApp() {
            const images = [
                "assets/fun1.png",
                "assets/fun2.png",
                "assets/fun3.png"
            ];
            const [currentImage, setCurrentImage] = React.useState(images[0]);
            React.useEffect(() => {
                let index = 0;
                const interval = setInterval(() => {
                    index = (index + 1) % images.length;
                    setCurrentImage(images[index]);
                }, 2000);
                return () => clearInterval(interval);
            }, []);
            return <img src={currentImage} className="w-full h-full object-cover" alt="Image dynamique" />;
        }

        function ViewCount() {
            const [views, setViews] = React.useState(1000);
            React.useEffect(() => {
                const interval = setInterval(() => {
                    setViews(prev => prev + 12);
                }, 1000);
                return () => clearInterval(interval);
            }, []);

            return (
                <span class="font-bold text-purple-400" id="viewCount">{views}</span>
            );
        }

        function AudioPlayer() {
            const playlist = [
                'assets/audio1.webm',
                'assets/audio2part1.webm',
                'assets/audio2part2.webm'
            ];

            const [currentTrack, setCurrentTrack] = React.useState(Math.floor(Math.random() * playlist.length));
            const [isPlaying, setIsPlaying] = React.useState(false);
            const [volume, setVolume] = React.useState(0.5); // Default volume to 50%
            const audioRef = React.useRef(null);

            React.useEffect(() => {
                if (audioRef.current) {
                    audioRef.current.src = playlist[currentTrack];
                    audioRef.current.onloadedmetadata = () => {
                        if (audioRef.current.duration) {
                            const randomStartTime = Math.random() * audioRef.current.duration;
                            audioRef.current.currentTime = randomStartTime;
                            audioRef.current.volume = volume; // Set the volume
                        }
                    };
                    audioRef.current.play().catch((error) => {
                        console.error("Playback blocked:", error);
                    });
                }
            }, [currentTrack]); // Ce useEffect ne d√©pend plus que de currentTrack

            const handleEnded = () => {
                setCurrentTrack((prev) => (prev + 1) % playlist.length);
            };

            const togglePlay = () => {
                if (audioRef.current) {
                    if (isPlaying) {
                        audioRef.current.pause();
                    } else {
                        audioRef.current.play().catch((error) => {
                            console.error("Lecture bloqu√©e :", error);
                        });
                    }
                    setIsPlaying(!isPlaying);
                }
            };

            const handleVolumeChange = (event) => {
                const newVolume = parseFloat(event.target.value);
                setVolume(newVolume);
                if (audioRef.current) {
                    audioRef.current.volume = newVolume; // Mettre √† jour le volume sans changer la source
                }
            };

            const changeRandomTrack = () => {
                const randomTrack = Math.floor(Math.random() * playlist.length);
                setCurrentTrack(randomTrack);
                const randomStartTime = Math.random() * audioRef.current.duration;
                audioRef.current.currentTime = randomStartTime;
            };

            return (
                <div className="audio-player mt-4">
                    <audio
                        ref={audioRef}
                        onEnded={handleEnded}
                        className="w-full"
                    />
                    <button
                        onClick={togglePlay}
                        className="mt-4 bg-purple-600 px-4 py-2 rounded text-white hover:bg-purple-500"
                    >
                        {isPlaying ? "üîá Couper le son" : "üîà Lancer le son"}
                    </button>
                    <button
                        onClick={changeRandomTrack}
                        className="mt-4 bg-purple-600 px-4 py-2 rounded text-white hover:bg-purple-500 ml-3"
                    >
                        Changer de ligne temporelle
                    </button>
                    <input
                        type="range"
                        min="0"
                        max="1"
                        step="0.01"
                        value={volume}
                        onChange={handleVolumeChange}
                        className="ml-3"
                    />
                </div>
            );
        }

        ReactDOM.render(<AudioPlayer />, document.getElementById('audioPlayerContainer'));
        ReactDOM.render(<ChatApp />, document.getElementById('chatApp'));
        ReactDOM.render(<ImageApp />, document.getElementById('imageApp'));
        ReactDOM.render(<ViewCount />, document.querySelector('#viewCount'));
    </script>
</body>
</html>
